#!/bin/bash

ls /tmp/scripts
ls /tmp/src

# Restore artifacts from the previous build (if they exist).
if [ "$(ls /tmp/artifacts/ 2>/dev/null)" ]; then
  echo "---> Restoring build artifacts..."
  ls /tmp/artifacts
  mv /tmp/artifacts/node_modules /opt/app-root/
fi

echo "---> Installing application source..."
cp -Rf /tmp/src/. /opt/app-root

HOME=/opt/app-root && \
    cd /opt/app-root && npm install -d