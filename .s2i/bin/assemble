#!/bin/bash

# Restore artifacts from the previous build (if they exist).
if [ "$(ls /tmp/artifacts/ 2>/dev/null)" ]; then
  echo "---> Restoring build artifacts..."
  ls /tmp/artifacts
  ls -la /tmp/artifacts/node_modules
  mv /tmp/artifacts/node_modules $APP_HOME/
fi

echo "---> Installing application source..."
cp -Rf /tmp/src/. $APP_HOME

ls -la $APP_HOME
cat $APP_HOME/package.json

HOME=$APP_HOME && \
    cd $APP_HOME  && npm install -d && npm run build